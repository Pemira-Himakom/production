{"ast":null,"code":"import { createSlice } from \"@reduxjs/toolkit\";\nimport { setUserLogout } from \"./authSlice\";\nimport { setLoading, setError, setSuccess } from \"./uiSlice\";\nconst VOTE_URL = \"/api/vote\";\nconst initialState = {\n  selected: {\n    name: null,\n    number: null\n  },\n  confirmation: false\n};\nexport const voteSlice = createSlice({\n  name: \"vote\",\n  initialState,\n  reducers: {\n    setSelect: (state, action) => {\n      state.selected = action.payload;\n    },\n    setConfirmation: state => {\n      state.confirmation = true;\n    },\n    resetVote: state => {\n      state.selected = {\n        name: null,\n        number: null\n      };\n      state.confirmation = false;\n    }\n  }\n});\n\n// vote fetch\nexport const postVote = input => {\n  return async dispatch => {\n    dispatch(setLoading());\n    const token = localStorage.getItem(\"token\");\n    localStorage.removeItem(\"token\");\n    const sendRequest = async input => {\n      console.log(input);\n      return fetch(VOTE_URL, {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          authorization: `Bearer ${token}`\n        },\n        method: \"POST\",\n        body: JSON.stringify({\n          votedCandidate: input\n        })\n      });\n    };\n    try {\n      const result = await sendRequest(input).then(data => {\n        return data.json();\n      });\n      if (result.status) {\n        dispatch(setSuccess(result.message));\n        // show meme?\n        dispatch(setUserLogout());\n        dispatch(resetVote());\n      } else {\n        dispatch(setError(result.message));\n        dispatch(setUserLogout());\n      }\n    } catch (error) {\n      dispatch(setError(error.message));\n      dispatch(setUserLogout());\n    }\n  };\n};\nexport const {\n  setSelect,\n  setConfirmation,\n  resetVote\n} = voteSlice.actions;\nexport default voteSlice.reducer;\nexport const selectedVote = state => state.vote;\nexport const selectedName = state => {\n  var _state$vote;\n  return (_state$vote = state.vote) === null || _state$vote === void 0 ? void 0 : _state$vote.selected.name;\n};\nexport const selectedNo = state => {\n  var _state$vote2;\n  return (_state$vote2 = state.vote) === null || _state$vote2 === void 0 ? void 0 : _state$vote2.selected.number;\n};","map":{"version":3,"names":["createSlice","setUserLogout","setLoading","setError","setSuccess","VOTE_URL","initialState","selected","name","number","confirmation","voteSlice","reducers","setSelect","state","action","payload","setConfirmation","resetVote","postVote","input","dispatch","token","localStorage","getItem","removeItem","sendRequest","console","log","fetch","headers","authorization","method","body","JSON","stringify","votedCandidate","result","then","data","json","status","message","error","actions","reducer","selectedVote","vote","selectedName","selectedNo"],"sources":["/home/hadzami/pemira/web-pemira-2022/client/src/store/voteSlice.js"],"sourcesContent":["import { createSlice } from \"@reduxjs/toolkit\";\nimport { setUserLogout } from \"./authSlice\";\nimport { setLoading, setError, setSuccess } from \"./uiSlice\";\n\nconst VOTE_URL = \"/api/vote\";\n\nconst initialState = {\n  selected: {\n    name: null,\n    number: null,\n  },\n  confirmation: false,\n};\n\nexport const voteSlice = createSlice({\n  name: \"vote\",\n  initialState,\n  reducers: {\n    setSelect: (state, action) => {\n      state.selected = action.payload;\n    },\n    setConfirmation: (state) => {\n      state.confirmation = true;\n    },\n    resetVote: (state) => {\n      state.selected = {\n        name: null,\n        number: null,\n      };\n      state.confirmation = false;\n    },\n  },\n});\n\n// vote fetch\nexport const postVote = (input) => {\n  return async (dispatch) => {\n    dispatch(setLoading());\n\n    const token = localStorage.getItem(\"token\");\n    localStorage.removeItem(\"token\");\n\n    const sendRequest = async (input) => {\n      console.log(input);\n      return fetch(VOTE_URL, {\n        headers: {\n          \"Content-Type\": \"application/json\",\n          authorization: `Bearer ${token}`,\n        },\n        method: \"POST\",\n        body: JSON.stringify({\n          votedCandidate: input,\n        }),\n      });\n    };\n\n    try {\n      const result = await sendRequest(input).then((data) => {\n        return data.json();\n      });\n\n      if (result.status) {\n        dispatch(setSuccess(result.message));\n        // show meme?\n        dispatch(setUserLogout());\n        dispatch(resetVote());\n      } else {\n        dispatch(setError(result.message));\n        dispatch(setUserLogout());\n      }\n    } catch (error) {\n      dispatch(setError(error.message));\n      dispatch(setUserLogout());\n    }\n  };\n};\n\nexport const { setSelect, setConfirmation, resetVote } = voteSlice.actions;\n\nexport default voteSlice.reducer;\n\nexport const selectedVote = (state) => state.vote;\nexport const selectedName = (state) => state.vote?.selected.name;\nexport const selectedNo = (state) => state.vote?.selected.number;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}